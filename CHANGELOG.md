# Hekili 黑科研修复版

v3.4.5-1.1.4

一、刺杀盗贼更新：
1.添加死亡印记(marked_for_death)技能支持 - 泰坦服新终结技
2.在APL中添加转嫁(shiv)用于快速上毒
3.优化循环逻辑：死亡印记期间避免使用其他终结技

v3.4.5-1.1.3

一、猫德修复：
1.修复爪击(Claw)在副本和团队中仍被推荐的问题 by 哑吡
  - 问题描述：爪击应该只在野外单人时使用，副本/团队应使用撕碎(Shred)
  - 解决方案：在reset_precast钩子中预先缓存实例类型，确保状态模拟时正确判断
  - 现在副本(party)和团队(raid)中会正确推荐撕碎而非爪击


v3.4.5-1.1.2

一、战士修复：
1.修复致死打击(mortal_strike)技能等级ID未注册导致的警告
  - 错误信息：IsKnown() - 47486 not found in abilities table
  - 解决方案：为ability定义添加copy字段，注册所有技能等级ID

二、通用修复：
1.修复资源不足时推荐图标消失的问题
  - 问题描述：当能量/怒气等资源不足时，所有职业的推荐图标会消失
  - 解决方案：当没有技能满足推荐条件时，显示auto_attack(普通攻击)作为后备
  - 图标会显示当前装备的主手武器纹理
  - 当资源恢复后，正常的技能推荐会替代普通攻击

v3.4.5-1.1.1

一、猎人修复：
1.修复兽王猎APL中eagle_shot找不到的问题 BY 哑吡
2.为hawk_shot添加eagle_shot/eagle别名，统一APL与代码定义

v3.4.5-1.1.0

一、死亡骑士修复：
1.修复State.lua中TimeToReady函数对数字类型进行索引导致的报错
2.修复forecastResources函数中资源表类型检查缺失的问题
3.修复死亡骑士符文冷却计算除以零的问题（regen为0时改用cooldown）
4.修复Core.lua中WotLK死亡骑士约束时间设置不正确的问题

二、技术改进：
1.增强state[resource]返回值的类型检查，避免对数字进行索引操作
2.兼容WotLK分离符文系统（blood_runes/frost_runes/unholy_runes）

v3.4.5-1.0.9

一、脚本修复：
1.修复Scripts.lua中SimToLua函数处理布尔值时报错的问题
2.错误信息：attempt to index local 'str' (a boolean value)
3.解决方案：布尔值直接转换为字符串返回，避免调用字符串方法报错


v3.4.5-1.0.7

一、插件修复：
1.修复Classes.lua中多处nil值字符串连接错误，解决"attempt to concatenate a nil value"问题
2.修复Options.lua中GetSpellInfo返回nil值导致的字符串连接错误
3.修复Events.lua中GetSpellInfo返回nil值的错误处理
4.完善所有纹理(texture)变量的nil值保护机制
5.优化物品和技能图标显示的容错处理

二、技术改进：
1.为所有GetSpellTexture()和GetItemIcon()调用添加回退机制
2.统一处理未定义texture变量的引用问题
3.增强代码健壮性，避免API返回nil值导致的崩溃

v3.4.5-1.0.6

一、插件完善：
1.完善各职业巫妖王“污染”点名玩家后提示“火箭靴”和“疾跑”逻辑，提高性能，修复问题。
2.加入红玉圣殿破甲饰品，调用函数piercing_twilight。
3.取消盗贼“暗影斗篷”判断。

二、职业完善

1.死亡骑士：增加各技能等级，避免错误识别。
2.猎人：修复稳固射击施法时间计算错误。

v3.4.5-1.0.5

一、插件完善：
1.完善快捷按钮功能，玩家暂离时隐藏。
2.加入火箭靴判断函数nitro_boosts
3.加入巫妖王“污染”技能判断逻辑
4.(实验)“全部黑科研循环”加入巫妖王“污染”点名玩家后提示“火箭靴”逻辑，调用函数defile_target_is_me。

二、职业完善

1.狂暴战：拳击技能分组由 默认 调整为 打断。
2.元素萨：全面修复元素萨职业技能lua错误，修复元素萨职业循环问题。

v3.4.5-1.0.4

一、插件完善：

1.完善冰冠堡垒战斗目标忽略名单（教授小怪、议会三王等），优化显示模式为自动时的目标数量判断。

二、职业调整

术士：修复鬼影缠身切换地图不提示的问题

死亡骑士：
1.完善血冰DK技能循环。
2.(试验)加入双光环DKT循环。
3.重新修复冰霜疾病识别错误问题。

盗贼：
1.(试验)新增女王蜂拥之影监控，开启“防御”选项后，第一时间提示 暗影斗篷。

v3.4.5-1.0.3

一、插件完善：

1.修复技能高亮提示，现在ndui也可以提示高亮技能了。

二、职业调整：

法师：
1.加入T10阶段法伤提升饰品函数magic_damage_increase，加入2T10触发buff函数pushing_the_limit。
2.修复活动炸弹技能id错误。
3.(试验)重做火法技能循环，完善燃烧3+1和2T10逻辑，供玩家测试。

其他：
1.修复暗牧的吸血鬼鞭笞、死亡骑士的天灾打击，修复暗牧T10套装物品id。
2.修改死亡骑士湮灭技能验证符文逻辑。

v3.4.5-1.0.2

职业调整（术士）

1.修改暗影箭和鬼影缠身的技能飞行速度为正确近似值，新增灵魂之火、烧尽技能飞行时间。
2.修复暗影箭、灵魂之火、烧尽施法时间，加入急速影响.
3.修复灵魂之火技能id错误。
4.修改痛苦无常技能施放逻辑。
5.加入鬼影缠身提前量，默认2s。
6.禁用超级加速器，由玩家自行释放。

bug：腐蚀术的刷新逻辑仍有问题，可以配合相关wa提示刷新。

v3.4.5-1.0.1

一、插件完善：
1、适配3.4.5版本。

二、职业调整（战士）：

1.优化狂暴战技能循环。
2.优化4T10循环猛击技能提示逻辑，加入猛击优先开关，默认关闭。可能存在增加公共冷却时间的bug 或 导致总伤害更低的问题，玩家自行决定。
3.优化破甲逻辑，启用后在没有贼打破甲情况下提示，只对boss级别有效。
4.优化各种怒吼逻辑。

v3.4.4-1.1.2

一、插件完善：
1、(实验)新增显示面板快捷按键，吸附在技能提示图标上方，可点击不可拖动。
2、加入冰冠堡垒副本(腐面-大软泥怪、小软泥怪，鲜血议会-黑暗之核，巫妖王-蹒跚的血僵尸、食尸鬼苦工)目标判断逻辑，自动模式下忽略此目标数量。

二、职业调整

猫德：
1、(实验)加入4T10后优先斜掠的开关，默认开启。
2、(实验)完善手套加速器逻辑，跟随猛虎之怒开启。
3、修改部分翻译错误

鸟德：
1、更新4T10套装技能循环，雕文：星辰坠落、星火、虫群。

猎人：
1、完善猎人爆炸陷阱发射器技能，现在由 爆炸陷阱发射器 代替 爆炸陷阱。

元素萨：
1、更新元素萨T10套装技能循环。

惩戒骑：
1、取消神圣愤怒释放提示，改由玩家自行选择。

战斗贼：
1、根据可乐_Hare 3.1版制作，感谢：可乐_Hare
2、调整了破甲释放判定，只对boss释放，同时加入破甲开关，默认开启。(风雪)

v3.4.4-1.1.1

职业调整

防骑：
1、新增守护(黑科研)技能循环。
2、修改防骑圣印切换逻辑，显示模式为"单体"时，使用复仇/腐蚀圣印；为"aoe"时，使用命令圣印，为"自动"时，按姓名版敌人数量切换圣印。
3、修复"696循环"问题，6秒技能间隔默认调整为2.7s。
4、删除防骑技能"神圣愤怒"选项和逻辑，改由玩家自行判断。
5、加入"奉献"阈值，默认为40%。
6、删除循环中“复仇者之盾”逻辑，改由玩家自行判断。
7、调整职业设置，更明显区分防骑和惩戒骑。

增强：
1、修复萨满选项卡问题选项。
2、修复增强(黑科研)技能循环问题，简化单体和aoe判定逻辑。
3、通用技能中，增加联盟萨满"英勇"。(不在循环内)

猎人：
1、技能提前量均放宽到0-1.5s，方便玩家调整。

v3.4.4-1.1.0

一、插件修复：
1、"超级加速器"分组由"主要爆发"改为"无"
2、修改部分翻译错误

二、职业调整

惩戒骑：
1、新增 惩戒(黑科研) 技能循环。
2、加入"奉献"阈值，默认为40%
3、修改"神圣恳求"技能组，由"主要爆发"改为"无"
4、修改战斗前祝福提示逻辑
5、修改部分配置项说明。
6、"神圣风暴"技能加入距离判断
7、(实验)修改复仇/腐蚀/命令圣印逻辑。显示模式为"单体"时，使用复仇/腐蚀圣印；为"aoe"时，使用命令圣印，为"自动"时，按姓名版敌人数量切换圣印。

猎人：
1、"野性呼唤"技能分类由“无”更改为“主要爆发”。
2、"猎人印记"优先级调低，"野性呼唤"技能分类由"无"更改为"主要爆发"
3、(实验)加入偷"黑箭"开关(默认关闭)，战斗开始后偷"黑箭"。
4、"爆炸陷阱发射器"与"爆炸陷阱"采用同样的技能提示。

v3.4.4-1.0.9

一、插件修复：
1、(实验)修复药剂列表,现在可以在职业下选择默认药剂了(变更后需重载界面)。存在按键显示bug,带按键的技能栏下只能放一种药剂,否则按键显示不正确。
2、新增奥杜尔团本不计算Wcl的小怪，自动模式下忽略此类小怪。

二、文本更新：
1、“爆发”改为“主要爆发”,“盟约”改为“次要爆发”

三、新增函数：
1、加入函数npcid,方便获取目标的ID,使用方法target.npcid

四、职业调整

死亡骑士：
1、修复冰霜疾病frost_fever判断问题,原判断为所有职业施放的,现修复为角色自身施放的。
2、白骨之盾技能分类由“防御”更改为“默认”。
3、取消亡者复生技能分类随天赋切换功能,任何专精下都为默认分组。
4、新增恶意魔印buff不洁之力,调用函数为unholy_force。
5、新增death_runes死亡符文计数函数。
6、修改icy_touch冰冷触摸技能消耗判定,如果有死亡符文,则不消耗冰冷符文。
7、(实验)加入传染判定函数shouldPestilence,判定依据为传染范围内任一目标没有任一疾病。

猎人：
1、(实验)修改猎人标记对团本boss的判定依据,改为target.level = (-1)。

增强萨满：
1、(实验)新增增强萨(黑科研)技能循环。

盗贼：
1、(实验)更新战斗贼(黑科研)技能循环。

德鲁伊：
1、更新鸟德4T9(黑科研)技能循环。


v3.4.4-1.0.8

1、修复全职业雕文条件的问题。
2、修复德鲁伊优先级过于强势的问题。
3、修复跟随天赋树自动切换优先级失效的问题。